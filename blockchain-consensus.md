# 共识算法

### 1. 去中心化的问题

 * 如何做决策
 * 如何执行具体的事务

### 2. 共识算法的定义

**共识决策实际上是一个集体决策的过程, 这个过程中，集体成员能够发展，并达成一个符合整体利益的决策。**

能够实现共识决策的方法就称之为**共识机制**，它具有以下特点：

* 谋求一致：共识机制应该在集体中尽可能多的达成一致。
* 协作：所有成员将集体利益放在第一位而共同工作。
* 集体：成员应该像一个team一样工作，而不是将自己的利益放在第一位。
* 平等：集体应该实现尽量平等，每个成员都应该有相同的权重，而不是谁更重要。
* 包容：共识机制应该尽可能多的让人参与进来，而不能像普通的决策一样，让成员因为感觉他们的参与无关紧要而不想参与。
* 吸引参与：共识机制应该有吸引成员参与全部过程的动机。

现在我们定义了什么是共识机制，共识机制应该达到什么目的，那么什么样的共识机制适用于区块链呢？

在比特币之前，出现了一些最后失败了的去中心化的货币系统，它们的问题是没有解决一个最大的问题：拜占庭将军问题。

### 3. 拜占庭将军问题

拜占庭将军要攻打一座城市，但是他们面临的问题是：

* 拜占庭将军很多，他们相互独立并不完全信任其他将军，他们和他们的军队处在不同的位置，信使传递需要时间而且可能出现意外，很难达成一致。
* 城市具有很强的防守力量，需要他们同一时间一起进攻才能成功。

![Related image](https://charlesliuyx.github.io/2018/03/03/%E3%80%90%E5%8C%BA%E5%9D%97%E9%93%BE%E3%80%91%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%B0%86%E5%86%9B%E9%97%AE%E9%A2%98/PBFT.png)

### 4. 共识机制

#### 工作量证明（Proof Of Work）

* 矿工解决数学难题以获得一个新的区块。
* 挖矿的过程应该需要极大的耗能和计算量，数学难题的设计对于系统来说应该是困难并且繁重的。
* 当矿工解决一个难题后，他们会广播给网络进行验证。
* 验证区块时候属于链的过程应该是极度简单的。

工作量证明机制解答了大部分的拜占庭问题，但是它也存在以下问题：

* 首先，工作量证明效率低下，耗能极大
* 一些人或者组织能够使用相应的硬件以达到更大的命中率。
* 因此，采用这种方式的区块链（比如比特币）并没有想象中的去中心化。

![ Understanding Blockchain Consensus Protocols: Basic Guide ](https://blockgeeks.com/wp-content/uploads/2018/01/image3-2.png)

#### 权益证明（Proof Of Stake）

* PoS会根据你持有货币的量和时间，给你发利息。**持有货币的时间，被称之为“币龄”**，每个币每天产生**1币龄。**
* 例如，你持有100个币，总共持有30天，你的币龄就是3000，此时，若你发现了一个PoS算法支持的区块（**直观来说就是你拥有币的数量和时间越长，你新建区块的几率越大**），你的币龄就会被置0。你每被清空365币龄，你将会从区块中获得0.05个币的利息（相当于年利率5%），那么在这个案例中，利息 = 3000 * 5% / 365 = 0.41个币。
* **你的“挖矿”收益将正比于你的币龄**，与算力无关。



##### Reference

1. https://blockgeeks.com/guides/blockchain-consensus/ 

2. https://charlesliuyx.github.io/2018/03/03/%E3%80%90%E5%8C%BA%E5%9D%97%E9%93%BE%E3%80%91%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%B0%86%E5%86%9B%E9%97%AE%E9%A2%98/#%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95

   